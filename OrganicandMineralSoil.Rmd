---
title: "OrganicandMineralSoil"
output: html_document
date: "2025-07-09"
---

Plotting the organic and mineral soil across treatments overtime 
```{r}
library(ggplot2)
library(dplyr)
library(ggpubr)  # for significance annotations

# Convert treatment to factor with desired order
dt13 <- dt13 %>%
  mutate(plot = factor(plot, levels = c("Control", "Heated")),
         horizon = factor(horizon, levels = c("Organic", "Mineral")))

# Summarize SOM means and SE by horizon and treatment
som_summary <- dt13 %>%
  group_by(plot, horizon) %>%
  summarise(
    mean_som = mean(som, na.rm = TRUE),
    se_som = sd(som, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  )

# Optional: t-test for significance (adjust if needed)
ttest_results <- dt13 %>%
  group_by(horizon) %>%
  summarise(
    p = t.test(som ~ plot)$p.value
  )

# Add asterisks based on p-value
ttest_results <- ttest_results %>%
  mutate(sig = case_when(
    p < 0.001 ~ "***",
    p < 0.01 ~ "**",
    p < 0.05 ~ "*",
    TRUE ~ "ns"
  ))

# Join significance back to the summary
som_summary <- som_summary %>%
  left_join(ttest_results, by = "horizon")

# Plot
ggplot(som_summary, aes(x = horizon, y = mean_som, fill = plot)) +
  geom_bar(position = position_dodge(width = 0.7), stat = "identity", color = "black", width = 0.6) +
  geom_errorbar(aes(ymin = mean_som - se_som, ymax = mean_som + se_som),
                width = 0.2, position = position_dodge(width = 0.7)) +
  # Add significance labels above bars
  geom_text(data = som_summary %>% filter(plot == "Heated"),
            aes(label = sig, y = mean_som + se_som + 0.03),
            position = position_dodge(width = 0.7), size = 5) +
  scale_fill_manual(values = c("Control" = "#999999", "Heated" = "#E69F00")) +  # color-blind friendly
  theme_classic(base_size = 14) +
  theme(
    axis.title = element_text(size = 16, face = "bold"),
    axis.text = element_text(size = 12),
    legend.title = element_blank(),
    legend.text = element_text(size = 12),
    panel.border = element_rect(colour = "black", fill = NA, size = 1),
    axis.line = element_blank()
  ) +
  labs(
    x = "Soil Horizon",
    y = "Soil Organic Matter (SOM %)"
  )

```

